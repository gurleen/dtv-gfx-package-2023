<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="../../font/stylesheet.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/external-svg-loader@1.6.10/svg-loader.min.js" async></script>
    <script type="text/javascript" src="../../shared.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"
        integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"
        integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+"
        crossorigin="anonymous"></script>
    <title>Halftime Stats</title>
</head>

<body style="visibility: hidden">
    <div id="svg"></div>
    <script>
        window.onerror = console.error

        window.onload = () => {
            loadSVG("Halftime Stats - Sponsor.svg")

            setHandler("gameId", async (v) => {
                let sport = window.cache["Sport"]
                let homeId = window.cache["Home-ID"]
                let raw = await fetch(`/live/${sport}/${v}?home_id=${homeId}`)
                let stats = await raw.json()

                console.log(stats)

                let usingStats = ["fg", "3fg", "ft", "reb", "to"]
                _.range(1, 6).forEach((i) => {
                    let stat = usingStats[i - 1]
                    let left = stats.home[stat]
                    let right = stats.away[stat]

                    let leftStat = document.getElementById(`Away-Stat-${i}`)
                    let rightStat = document.getElementById(`Home-Stat-${i}`)

                    leftStat.innerHTML = left
                    rightStat.innerHTML = right
                })
            })


            setHandler("Home-Stats", (v) => {
                let stats = v.split(",")
                _.range(1, 6).forEach((i) => {
                    updateText(`Home-Stat-${i}`, stats[i - 1])
                    updateText(`Away-Stat-${i}`, stats[i - 1])
                })
            })

            setHandler("Away-Stats", (v) => {
                let stats = v.split(",")
                _.range(1, 6).forEach((i) => {
                    updateText(`Away-Stat-${i}`, stats[i - 1])
                })
            })

            
        }

        window.addEventListener("loaded", () => {
            tl.from("#Page-1", { duration: 0.5, x: "-=100", opacity: 0, ease: "power3.out" });
            tl.from("text", { duration: 0.5, x: "-=50", opacity: 0, ease: "power3.out" }, "-=0.4")
            tl.from("#Drexel-PT-For-ANIMATION-QR", { opacity: 0, y: "-=100", duration: 0.5, ease: "power3.out" })
            tl.call(() => setPlaying())
            tl.addPause("+=0", checkForStop)
            tl.to("#Page-1", { duration: 0.3, opacity: 0, ease: "power3.out" })

            _.range(1, 6).forEach((i) => {
                endAlignText(`Home-Stat-${i}`, 500)
            })

            middleAlignText("Home-Team-Name", 1100)
            middleAlignText("Away-Team-Name", 825)
            middleAlignText("Title", 950)

            showBody();
            updateFromBox();
        })

        updateFromBox = () => {
            try {
                let box = get("http://localhost:8081/half");
                _.range(1, 6).forEach((i) => {
                    updateText(`Home-Stat-${i}`, box.home[i - 1])
                    updateText(`Away-Stat-${i}`, box.away[i - 1])
                })
            } catch (e) {
                console.error(e)
            }
        }

        window.handleExtra = async (k, v) => {

        }
    </script>
</body>

</html>